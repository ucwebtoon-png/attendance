<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>출석 체크</title>
</head>
<body>
  <h3 id="msg">위치 확인 중...</h3>

<script>
  const BASE_LAT = 129.31136596;  // 회사/학원 위도
  const BASE_LON = 35.5383773; // 회사/학원 경도
  const ALLOW_RADIUS = 4000;  // 허용 반경(미터)

  function distance(lat1, lon1, lat2, lon2) {
    const R = 6371e3;
    const toRad = x => x * Math.PI / 180;
    const dLat = toRad(lat2 - lat1);
    const dLon = toRad(lon2 - lon1);
    const a = Math.sin(dLat/2)**2 +
              Math.cos(toRad(lat1)) *
              Math.cos(toRad(lat2)) *
              Math.sin(dLon/2)**2;
    return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
  }

  // 여기서 이름을 입력받고 서버에 출석 데이터 전송 시작
    const userName = prompt("이름을 입력하세요");  // 사용자 이름 받기

    fetch("https://script.google.com/macros/s/AKfycbzopxH3F_BpJR4-iKwYHljy8O2NpwcypOK6Q7DCw4bhyK_TE1R9xHi0YyNn-Unszz4q/exec", {  // 1단계에서 복사한 URL
      method: "POST",
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        name: userName,
        lat: latitude,
        lon: longitude,
        accuracy: accuracy
      })
    })
    .then(response => response.json())
    .then(data => {
      if (data.status === "success") {
        document.getElementById("msg").innerText = "✅ 출석 완료!";
      } else {
        document.getElementById("msg").innerText = "❌ 출석 실패";
      }
    })
    .catch(() => {
      document.getElementById("msg").innerText = "❌ 기록 서버 오류";
    });

  },
  () => {
    document.getElementById("msg").innerText = "❌ 위치 권한이 필요합니다";
  }
);

